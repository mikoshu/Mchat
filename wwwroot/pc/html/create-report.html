
<style>
         .r_form select::-ms-expand { display: none; }          
 select::-ms-expand { display: none; }    
</style>

        <div class="r_content">
            <div class="r_title">
                <p id="tap1_2" class="tap1_2">创建M-CHAT报告</p>
            </div>
            <div class="r_article create-report">     


              <div class="r_form">
                  <div>儿童姓名:</div>
                  <div><input class="chat_input" id="testeeName" style="width:350px" type="text" /></div>
              </div>
              
              <div class="r_form">
                  <div>性别:</div>
                  <div>
                    <select class="chat_input" id="sex" style="width:350px">
                      <option value="1">男</option>
                      <option value="0">女</option>
                    </select>
                  </div>
              </div>
              
              <div class="r_form">
                  <div>身份信息:</div>
                  <div>
                  <select name="" id="cardType" class="chat_input" style="width:120px">
                    <option value="0">儿童身份证</option>
                    <option value="1">父亲身份证</option>
                    <option value="2">母亲身份证</option>
                    <option value="3">诊疗卡号</option>
                    <option value="9">其他</option>
                  </select>
                  <input class="chat_input" id="cardNo" style="width:225px" type="text" />
                  </div>
              </div> 
              
              <!-- <div class="r_form">
                  <div>事件标题:</div>
                  <div><input class="chat_input" style="width:350px" type="text" /></div>
              </div> -->
              
              <!-- <div class="r_form">
                  <div>&nbsp;</div>
                  <div><p class="check_history" style="width:125px;">检查历史档案</p></div>
              </div> -->
              
              <BR />
              <div class="r_form">
                  <div>出生日期:</div>
                  <div><input type="text" id="birthYear" class="year"> 年
                      <input type="text" id="birthMonth" class="month"> 月
                      <input type="text" id="birthToday" class="day"> 日
                  <!--<input class="chat_input Wdate" id="birthDay" onClick="WdatePicker()" style="width:350px; height:37px;"/>-->
                  </div>
              </div> 
              <div class="r_form">
                  <div>完成问卷日期:</div>
                  <div><input type="text" id="testYear" class="year"> 年
                      <input type="text" id="testMonth" class="month"> 月
                      <input type="text" id="testToday" class="day"> 日
                  <!--<input class="chat_input Wdate" id="testDay" onClick="WdatePicker()" style="width:350px; height:37px;"/>-->
                  </div>
              </div> 
              <div class="r_form">
                  <div>&nbsp;</div>
                  <div><p class="check_history f_l" style="width:125px;" id="getAge">计算年龄</p><p>&nbsp;&nbsp;&nbsp;&nbsp;儿童生活年龄：<span id="age"></span></p></div>
              </div>
              
              <BR />
              <div class="r_form">
                  <div>宝宝的孕周:</div>
                  <div>
                  <input id="gestationalWeeks" class="chat_input r_form_week" style="width:155px" type="text" />
                  <input id="gestationalDays" class="chat_input r_form_day" style="width:155px" type="text" />
                  </div>
              </div>         
              <div class="r_form">
                  <div>出生时情况(多选):</div>
                  <div>
                  <div id="birthsBox" class="chat_input births-box"  style="width:350px; margin-top: 0;" >
                  <div id="birthsInput" style="width:100%;margin-top: 0;" ></div>
                  <ul class="m-select-info-c births-pop">
                    <li>
                      <label>
                        <input class="births" value="0" type="checkbox">
                        <span>足月</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="1" type="checkbox">
                        <span>早产</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="2" type="checkbox">
                        <span>顺产</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="3" type="checkbox">
                        <span>剖腹产</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="4" type="checkbox">
                        <span>产钳助产</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="5" type="checkbox">
                        <span>吸引器助产</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="6" type="checkbox">
                        <span>双胎</span>
                      </label>
                    </li>
                    <li>
                      <label>
                        <input class="births" value="7" type="checkbox" id="yc">
                        <span>其他异常情况</span>
                      </label>
                    </li>
                    <li>
                      <a id="births-sure" href="javascript:;">确定</a>
                    </li>
                  </ul>
                  </div>
                  </div>
              </div>
                
              <!-- <div class="r_form">
                  <div>&nbsp;</div>
                  <div><p class="check_history f_l"  style="width:125px;">计算矫正年龄</p><p>&nbsp;&nbsp;&nbsp;&nbsp;早起矫正年龄：一月一天</p></div>
              </div> -->
              
              <BR />
              <div class="r_form">
                  <div>&nbsp;</div>
                  <div>温馨提示：上面信息为必填信息，请全部填写，谢谢</div>
              </div>
              <div class="r_form" id="yc-box" style="display: none">
                  <div>异常情况:</div>
                  <div>
                  <input id="abnormalities" class="chat_input" style="width:350px" type="text" />
                  </div>
              </div>  
              
              <BR />
              <div class="r_form">
                  <div>&nbsp;</div>
                  <div><p class="check_history f_l" id="add" style="width:350px;">+增加填写问卷人信息填写</p></div>
              </div>
                
              <div class="r_form">
                    <div>&nbsp;</div>
                    <div>
                        <input type="button" id="sure" style="float:left;" class="r_form_s r_form_submit" value="确认" />
                        <input type="button" style="float:left;" class="r_form_s r_form_reset" value="取消" /> 
                    </div>
                </div>
 
            </div>
            
            
          <!--   <div class="r_form_sub">
                <p><input type="button" id="sure" class="r_form_s r_form_submit" value="确认" /></p>
                <p><input type="button" class="r_form_s r_form_reset" value="取消" /></p>
            </div> -->
            
            
        </div>
    </div>

<script id="q" type="text/html">
  <div class="question">
        <div class="q-main">
            <div class="q-head">
                
                <ul class="tab-head">
                    <li class="active">1</li>
                    <li>2</li>
                    <li>3</li>
                    <li>4</li>
                    <li>5</li>
                    <li>6</li>
                    <li>7</li>
                    <li>8</li>
                    <li>9</li>
                    <li>10</li>
                    <li>11</li>
                    <li>12</li>
                    <li>13</li>
                    <li>14</li>
                    <li>15</li>
                    <li>16</li>
                    <li>17</li>
                    <li>18</li>
                    <li>19</li>
                    <li>20</li>
                </ul>
            </div>
            <div class="q-content">
                <div class="tab-con" style="display: block;">
                    <p>1.  如果您指向房间内的某样东西，孩子会看它吗？（例如，您指着一个玩具或一只动物，孩子会看这个玩具或这只动物吗？）</p>
                    <img src="../images/pic/1.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>2. 您怀疑过孩子的听力有障碍（耳聋）吗？</p>
                    <img src="../images/pic/2.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>3. 您的孩子会玩假装游戏吗？（例如，假装从空的杯子中喝水，假装打电话，假装喂娃娃或毛绒玩具？）</p>
                    <img src="../images/pic/3.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>4. 您的孩子喜欢爬上爬下吗？（如家具、游乐场设施、或楼梯）</p>
                    <img src="../images/pic/4.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>5. 您的孩子会在自己眼睛附近做一些奇怪的手指活动吗？（例如，您的孩子会在眼睛前摆动手指吗？）</p>
                    <img src="../images/pic/5.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>6. 您的孩子会用一根手指指东西表示需要或寻求帮助吗？（例如，指着他/她够不到的一块点心或玩具）</p>
                    <img src="../images/pic/6.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>7. 您的孩子会用一根手指指东西，向您展示有趣的东西吗？（例如，指向天空中的飞机或马路上的卡车）</p>
                    <img src="../images/pic/7.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>8. 您的孩子对其他孩子感兴趣吗？（例如，您的孩子会看其他孩子，对他/她们笑，走向他/她们吗？）</p>
                    <img src="../images/pic/8.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>9. 您的孩子会把东西拿给您，或举着东西给您看吗？不是寻求帮助，而只是分享。（例如，给您看花、毛绒玩具动物或玩具卡车）</p>
                    <img src="../images/pic/9.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>10. 您叫孩子名字的时候，他/她会有反应吗？（例如，您叫他/她的名字，他/她会抬头看、说话或发出咿呀声、或者停下正在做的事吗？）</p>
                    <img src="../images/pic/10.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>11. 您对您的孩子笑的时候，他/她也会对您笑吗？</p>
                    <img src="../images/pic/11.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>12. 您的孩子会因为日常噪音而感到不安吗？（例如，您的孩子会因为电吹风或高分贝音乐而尖叫或哭闹吗？）</p>
                    <img src="../images/pic/12.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>13. 您的孩子会走路了吗？</p>
                    <img src="../images/pic/13.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>14. 当您跟孩子说话、玩耍或穿衣服时，他/她会与您对视吗？</p>
                    <img src="../images/pic/14.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>15. 您的孩子会模仿您做的事吗？（例如，挥手再见、鼓掌或者发出有趣的声音）</p>
                    <img src="../images/pic/15.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>16. 如果您转头看某样东西，您的孩子会转过头来试图了解您在看什么吗？</p>
                    <img src="../images/pic/16.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>17. 您的孩子会试图让您去看他/她吗？（例如，您的孩子会看着您等待夸奖，或者说“看”、“看我”吗？）</p>
                    <img src="../images/pic/17.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>18. 当您告诉您的孩子去做某事时，他/她能理解吗？（例如，如果您不用手指，您的孩子能理解“把书放在椅子上”或“给我拿拖鞋”吗？）</p>
                    <img src="../images/pic/18.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>19. 如果发生了新鲜事，您的孩子会看您的脸去观察您的反应吗？（例如，如果他/她听到了奇怪或有趣的声音或看到了新玩具，他/她会看您的脸吗？）</p>
                    <img src="../images/pic/19.gif" alt="">
                </div>
                <div class="tab-con">
                    <p>20. 您的孩子喜欢被摇晃吗？（例如，在您的膝盖上摇晃或弹跳）</p>
                    <img src="../images/pic/20.gif" alt="">
                </div>
                
            </div>
            <div class="choose">
                <label>
                    <input id="yes" type="radio" value="Y" name="question">
                    是
                </label>
                <label>
                    <input id="no" type="radio" value="N" name="question">
                    否
                </label>
                
            </div>
            <div class="q-btn">
                <a id="last" href="javascript:;">上一题</a>
                <a id="next" href="javascript:;">下一题</a>
            </div>
        </div>
        
    </div>

</script>

<script id="pop" type="text/html">
<div id="p_content">
    <!-- <div class="p_title"><p>完成问卷人的信息填写</p></div> -->
    <div class="p_form">
        <div>完成问卷人姓名:</div>
        <div><input class="chat_input" id="consignorName" style="width:300px" type="text" /></div>
    </div>
    <div class="p_form">
        <div>与儿童的关系:</div>
        <div>
          <select class="chat_input" id="consignorType" style="width:300px" type="text" >
            <option selected="selected"  value="0">未选择</option>
            <option  value="1">父母</option>
            <option  value="2">祖父母</option>
            <option  value="3">照看人</option>
            <option  value="4">老师</option>
            <option  value="5">其他</option>
          </select>
        </div>
    </div>
    <div class="p_form">
        <div>儿童出生时的体重:</div>
        <div><input class="chat_input" id="birthWeight" style="width:300px" type="text" /></div>
    </div>
    <div class="p_form">
        <div>通讯地址:</div>
        <div><input class="chat_input" id="address" style="width:300px" type="text" /></div>
    </div>
    <div class="p_form">
        <div>邮政编码:</div>
        <div><input class="chat_input" id="zip" style="width:300px" type="text" /></div>
    </div>
    <div class="p_form">
        <div>联系电话:</div>
        <div><input id="tel" class="chat_input" style="width:300px" type="text" /></div>
    </div>
    
    <div class="p_form">
        <p style=" text-align:center;font-size:14px;">若代替填写问卷请列出代替填写人的性名、与宝来宾席的关系或身份</p>
    </div>
    <div>
        <p style="text-align:center;font-size:14px;">
          <input type="text" id="remark" class="chat_input" style="width:300px;" />
        </p>
    </div>
    <div class="p_form">
        <div>母亲文化程度:</div>
        <div>
          <select id="motherCultureDegree" class="chat_input" style="width:300px">
              <option value="0">未选择</option>
              <option value="1">小学</option>
              <option value="8">完成部分初中课程</option>
              <option value="2">初中毕业</option>
              <option value="3">完成部分高中课程</option>
              <option value="4">高中毕业</option>
              <option value="5">完成部分大学课程(至少一年)</option>
              <option value="6">大学毕业(大专或大学)</option>
              <option value="7">硕士毕业或以上</option>
          </select>
        </div>
    </div>
    <div class="p_form">
        <div>母亲职业:</div>
        <div>
          <select id="motherCareerCategory" class="chat_input job-type" style="width:143px">
            <option value="">未选择</option>
            <option value="1">第一大类</option>
            <option value="2">第二大类</option>
            <option value="3">第三大类</option>
            <option value="4">第四大类</option>
            <option value="5">第五大类</option>
            <option value="6">第六大类</option>
            <option value="7">第七大类</option>
            <option value="8">第八大类</option>
            <option value="9">第九大类</option>
            <option value="10">第十大类</option>
          </select>
          <select id="motherCareer" class="chat_input" style="width:150px">
            <option value="">先选择职业类型</option>
          </select>
        </div>
    </div> 
    <div class="p_form">
        <div>父亲文化程度:</div>
        <div>
          <select id="fatherCultureDegree" class="chat_input" style="width:300px">
            <option value="0">未选择</option>
              <option value="1">小学</option>
              <option value="8">完成部分初中课程</option>
              <option value="2">初中毕业</option>
              <option value="3">完成部分高中课程</option>
              <option value="4">高中毕业</option>
              <option value="5">完成部分大学课程(至少一年)</option>
              <option value="6">大学毕业(大专或大学)</option>
              <option value="7">硕士毕业或以上</option>
          </select>
        </div>
    </div> 
    <div class="p_form">
        <div>父亲职业:</div>
        <div>
          <select id="fatherCareerCategory" class="chat_input job-type" style="width:143px">
            <option value="">未选择</option>
            <option value="1">第一大类</option>
            <option value="2">第二大类</option>
            <option value="3">第三大类</option>
            <option value="4">第四大类</option>
            <option value="5">第五大类</option>
            <option value="6">第六大类</option>
            <option value="7">第七大类</option>
            <option value="8">第八大类</option>
            <option value="9">第九大类</option>
            <option value="10">第十大类</option>
          </select>
          <select id="fatherCareer" class="chat_input" style="width:150px">
            <option value="">先选择职业类型</option>
          </select>
        </div>
    </div> 
    <div class="p_form">
        <div>主要照顾者文化程度:</div>
        <div>
          <select id="caregiversCultureDegree" class="chat_input" style="width:300px">
            <option value="0">未选择</option>
              <option value="1">小学</option>
              <option value="8">完成部分初中课程</option>
              <option value="2">初中毕业</option>
              <option value="3">完成部分高中课程</option>
              <option value="4">高中毕业</option>
              <option value="5">完成部分大学课程(至少一年)</option>
              <option value="6">大学毕业(大专或大学)</option>
              <option value="7">硕士毕业或以上</option>
          </select>
        </div>
    </div> 
    <div class="p_form">
        <div>母亲出生日期:</div>
        <div>
        <input type="text" id="motherYear" class="year"> 年
        <input type="text" id="motherMonth" class="month"> 月
        <input type="text" id="motherDay" class="day"> 日
        <!-- <input id="motherBirthday" class="chat_input Wdate" onClick="WdatePicker()" style="width:300px" /> -->
        </div>
    </div> 
    <div class="p_form">
        <div>父亲出生日期:</div>
        <div>
        <input type="text" id="fatherYear" class="year"> 年
        <input type="text" id="fatherMonth" class="month"> 月
        <input type="text" id="fatherDay" class="day"> 日
        <!-- <input id="fatherBirthday" class="chat_input Wdate" onClick="WdatePicker()" style="width:300px" /> -->
        </div>
    </div> 
     <div class="p_form">
        <div>婚姻状况:</div>
        <div>
        <select id="maritalStatus" class="chat_input" style="width:300px">
        <option value="0">未选择</option>
              <option value="1">未婚</option>
              <option value="2">已婚</option>
              <option value="3">离异</option>  
        </select>
        </div>
    </div>       
     <!--  <div class="p_form_sub">
          <p><input type="button" class="p_form_s p_form_submit" value="确认" /></p>
          <p><input type="button" class="p_form_s p_form_reset" value="先不填写" /></p>
      </div>    -->
</div>
</script>

<script>
  $(document).ready(function(){

    var jobData = {
        Career1 : ['请选择','按日计酬的散工','公共空间清洁工','家庭清洁工','农场工人','食品零售','后厨食物制备工','餐馆楼面杂工'],
        Career2 : ['请选择','垃圾收集工','快餐厨子','出租车司机','鞋类销售员','流水线工人','泥瓦匠','行李搬运工'],
        Career3 : ['请选择','油漆工','建筑技工','售货员','卡车司机','厨师','销售柜台','办公室文员'],
        Career4 : ['请选择','汽车修理工','打字员','锁匠','农场工','木工','前台接待/总机','建筑工人','理发/发型师'],
        Career5 : ['请选择','机械师/机工','乐手/音乐制作人','簿记员/档案管理员','秘书','保险销售员','家具木工','人事管理','焊工'],
        Career6 : ['请选择','部门主管','图书管理员','航空机械师','视觉艺术工作者','电工','行政管理人员','现役军人','采购员'],
        Career7 : ['请选择','护士','熟练技工','医疗卫生专业技术员','顾问/咨询师','经理/经纪','警察','消防员','财务经理','物理治疗师','作业治疗师','言语治疗师'],
        Career8 : ['请选择','机械工程师','原子能工程师','电子工程师','教育行政人员','兽医','军官','中学教师','小学教师','特殊教育教师'],
        Career9 : ['请选择','医生','律师','大学任教老师','化工工程师','航天工程师','法官','首席执行官','高级管理人员','公务员','心理师','药剂师','会计师'],
        Career10 : ['请选择','未受雇佣','其它']
    }
    
    var obj1 = {};
    var obj2 = {};
    var obj3 = {};


    $("#add").on('click',function(){
        var height = window.innerHeight;
        height = height < 770 ? height+'px' : 'auto';
        layer.open({
          title: "增加填写问卷人信息填写",
          content: $("#pop").html(),
          area: ["620px",height],
          btn: ["确定","先不填写"],
          yes: function(index){
            var consignorName = $("#consignorName").val();
            var consignorType = $("#consignorType").val();
            var weight = $("#birthWeight").val();
            var address = $("#address").val();
            var zip = $("#zip").val();
            var tel = $("#tel").val();
            var remark = $("#remark").val();
            var motherCultureDegree = $("#motherCultureDegree").val();
            var motherCareerCategory = $("#motherCareerCategory").val();
            var motherCareer = $("#motherCareer").val();
            var fatherCultureDegree = $("#fatherCultureDegree").val();
            var fatherCareerCategory = $("#fatherCareerCategory").val();
            var fatherCareer = $("#fatherCareer").val();
            var caregiversCultureDegree = $("#caregiversCultureDegree").val();
            var motherYear = $("#motherYear").val();
            var motherMonth = $("#motherMonth").val();
            var motherDay = $("#motherDay").val();
            var fatherYear = $("#fatherYear").val();
            var fatherMonth = $("#fatherMonth").val();
            var fatherDay = $("#fatherDay").val();

            //var motherBirthDay = $("#motherBirthday").val();
            //var fatherBirthDay = $("#fatherBirthday").val();
            var maritalStatus = $("#maritalStatus").val();
            obj2 = {
              consignorName: consignorName,
              consignorType: consignorType,
              birthWeight : weight,
              address: address,
              zip: zip,
              tel: tel,
              remark: remark,
              motherCultureDegree : motherCultureDegree,
              motherCareerCategory: motherCareerCategory,
              motherCareer: motherCareer,
              fatherCultureDegree: fatherCultureDegree,
              fatherCareerCategory: fatherCareerCategory,
              fatherCareer: fatherCareer,
              caregiversCultureDegree: caregiversCultureDegree,
              motherYear: motherYear,
              motherMonth: motherMonth,
              motherDay: motherDay,
              fatherYear: fatherYear,
              fatherMonth: fatherMonth,
              fatherDay: fatherDay,
              maritalStatus: maritalStatus
            }
            layer.close(index);
          },
          success: function(){
            for(key in obj2){
              $("#"+key).val(obj2[key]);
            }
          }

        })
    });

    $("body").delegate('#getAge','click',function(){
      var year = $("#birthYear").val();
      var month = $("#birthMonth").val();
      var day = $("#birthToday").val();
      if(year && month && day){
        var birth = year+'-'+month+'-'+day;
      }else{
        layer.msg('请填写出生时间');
        return false;
      }

      var age = util.getAge(birth);
      $("#age").text(age);
    });
    

    $("body").delegate('.job-type','change',function(){
      var type = $(this).val();
      $this = $(this);
      if(type != ''){
        var html = '';
        jobData['Career'+type].map(function(val,i){
          html += '<option value="'+i+'" >'+val+'</option>';
        });
        $this.next().html(html);

      }
      
    });

    $("body").delegate('#sure','click',function(){
      var testeeName = $("#testeeName").val();
      var sex = $("#sex").val();
      var cardType = $("#cardType").val();
      var cardNo = $("#cardNo").val();
      var birthYear = $("#birthYear").val();
      var birthMonth = $("#birthMonth").val();
      var birthToday = $("#birthToday").val();
      var testYear = $("#testYear").val();
      var testMonth = $("#testMonth").val();
      var testToday = $("#testToday").val();
      var gestationalWeeks = $("#gestationalWeeks").val();
      var gestationalDays = $("#gestationalDays").val();
      var births = [];
      var abnormalities = $("#abnormalities").val();
      $(".births:checked").each(function(i,dom){
        births.push($(dom).val());
      });
      births = births.join(";");
      
      if(testeeName == ''){
        layer.msg('儿童姓名不能为空！');
        return false;
      }
      if(cardNo == ''){
        layer.msg('身份信息不能为空！');
        return false;
      }
      if(birthYear==''||birthMonth==''||birthToday==''){
        layer.msg('出生日期格式错误！');
        return false;
      }
      if(testYear==''||testMonth==''||testToday==''){
        layer.msg('完成问卷日期格式错误！');
        return false;
      }

      if(gestationalWeeks == ''){
        layer.msg('宝宝孕周不能为空！');
        return false;
      }
      if(gestationalDays == ''){
        layer.msg('宝宝孕天不能为空！');
        return false;
      }

      // if(births == ''){
      //   layer.msg('出生时情况不能为空！');
      //   return false;
      // }
      

      obj1 = {
        testeeName: testeeName,
        sex: sex,
        cardType: cardType,
        cardNo: cardNo,
        birthYear: birthYear,
        birthMonth: birthMonth,
        birthToday: birthToday,
        testYear: testYear,
        testMonth: testMonth,
        testToday: testToday,
        gestationalWeeks: gestationalWeeks,
        gestationalDays: gestationalDays,
        births: births,
        level: 1,
        abnormalities: abnormalities
      }
      var obj = obj1;
      for(key in obj2){
        obj1[key] = obj2[key];
      }
      util.client({
        url: util.requestURL+'/web/v1/medicMchat/verifyBasicInformation',
        type: 'POST',
        data: obj,
        success: function(data){
          if(data.code == 1){
            showQuestion();
          }
          layer.msg(data.msg);
        }
      })

    });

    $("body").delegate('#birthsBox','click',function(){
      var y = $("#birthYear").val();
      var date = new Date().getFullYear();
      if(y == ''){
        layer.msg('请填写出生日期')
        return
      }
      if(date - y > 1){
        layer.msg('大于24个月0天的儿童不用选择“出生时情况”')
        return
      }
      console.log(y,date)
      $(".births-pop").show();

    })

    $("body").delegate('#births-sure','click',function(e){
      var html = '';
      $(".births:checked").each(function(i,dom){
        html += $(dom).next().text() + ',';
      });
      html = html.substring(0,html.length-1);
      $("#birthsInput").text(html);
      e.stopPropagation();
      $(".births-pop").hide();
    });

    
    
    function showQuestion(){
      var height = parseInt(window.innerHeight);
      height = height > 835 ? 'auto' : height+'px';
      var lay = layer.open({
        title: '请回答下列问题以完善问卷',
        content: $("#q").html(),
        area: ["900px",height],
        type: 1,
        success: function(l){
          var $tab = $(".tab-head"),
                $con = $(".tab-con"),
                $last = $("#last"),
                $next = $("#next"),
                $choose = $(".choose"),
                $yes = $("#yes"),
                $no = $("#no"),
                index = 0,
                answer = obj3;
            $tab.find('li').on('click',function(){
                var eq = $(this).index();
                index = eq;
                toggle();
            });

            $next.on('click',function(e){
                if(index == 19){
                  var n = 0;
                  for(key in answer){
                    n += 1;
                  }
                  if(n == 20){
                    
                    var obj = obj1;
                    for(key in obj3){
                      obj1[key] = obj3[key];
                    } 
                    util.client({
                      url: util.requestURL+'/web/v1/medicMchat/createMchatReport',
                      type: 'POST',
                      data: obj,
                      success: function(data){
                        if(data.code == 1){
                          layer.close(lay);
                        }
                        layer.msg(data.msg);
                      }
                    })
                  }else{
                    layer.msg('请回答完全部问题再提交！');
                  }
                  return false
                }
                index += 1;
                toggle();
            });

            $last.on('click',function(e){
                if(index == 0){
                    return false
                }
                index -= 1;
                toggle();
            });

            $choose.find('input').on('click',function(){
                answer['topic_'+(index+1)] = $(this).val();
            });

            function toggle(){
                $con.eq(index).fadeIn().siblings('div').fadeOut();
                $tab.find('li').eq(index).addClass('active').siblings('li').removeClass('active');
                $choose.find('input').prop('checked',false);
                if(answer.hasOwnProperty(index+1)){
                    answer[index+1] == 1 ? $yes.prop('checked','checked') :  $no.prop('checked','checked') ;
                }
                if(index == 19){
                  $next.text("完成");
                }else{
                  $next.text("下一题");
                }
                for(key in answer){
                    var eq = key.split("_")[1];
                    $tab.find('li').eq(eq-1).addClass('al')
                }
                
            }

        }
      })
    }

    $("#yc").on('change',function(){
      var flag = $(this).prop('checked');
      console.log(flag)
      if(flag){
        $("#yc-box").show();
      }else{
        $("#yc-box").hide();
      }
    })

  });
</script>
